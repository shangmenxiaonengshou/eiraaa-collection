# 委派攻击

委派是大型网络中经常部署的应用模式，给多跳认证带来了很大的便利，但是与此同时也带来了很大的安全隐患，利用委派，攻击者客户获取本地管理员甚至与管理员的权限，还可以制作深度隐藏的后门

域委派是走kerborse 认证的
`SPN`：服务实例，可以理解为一个服务的唯一标识符(Http,Mssql)

委派属性：在域中，只有主机账号和服务账号才具有委派属性(普通用户是没有委派属性的)

- 主机账号就是活动目录中computers 中的计算机，也可以称为机器账号
- 服务账号是域内账号的一种类型，是将服务运行起来并加入域时所用的账号。如SQL Server在安装时，会在域内自动注册服务账号 SQLServiceAccount,也可以将域用户通过注册SPN变为服务账号

委派的分类：

- 非约束性委派（UD)注意，域控默认配置了非约束性委派
- 约束性委派 (CD)
  - 一种是仅使用kerberos 认证，不能进行协议转换
  - 一红是使用任何身份验证协议，可以进行协议转换（如果不走kerberos认证而是web走表单认证这时就算server1被hacker控制也无法抓取到tgt票据）
- **基于资源访问的约束性委派 (RBCD) 重点**
- 

非约束性委派



S4u2self

S4u2proxy
